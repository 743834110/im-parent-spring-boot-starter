(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[26],{ydEL:function(e,a,t){"use strict";t.r(a);t("dZVJ");var n,r,l,i,c,o,s,d=t("Nf2q"),u=(t("RP/e"),t("izPl")),m=(t("/J8Y"),t("zfnJ")),h=t("U1Sa"),p=t.n(h),f=t("Pjwa"),y=t.n(f),g=t("2cji"),E=t.n(g),v=t("sp3j"),b=t.n(v),k=t("vZkh"),S=t.n(k),C=t("+KCP"),F=t.n(C),w=(t("y5MA"),t("Gywv")),I=(t("T+7u"),t("S/fC")),R=(t("5L90"),t("aCNS")),D=(t("CyPW"),t("q5eX")),x=t("/0b7"),T=t.n(x),N=t("LneV"),P=t("Kf7D"),O=(t("a/LZ"),t("G7KD")),_=t("zHco"),U=(t("xYz8"),t("WnAZ")),K=t("AWcK"),A=t("+n12"),L=t("DUVc"),V=(t("jdV2"),t("Shk8")),j=(t("IB1T"),t("scLQ")),B=(t("wih3"),t("69Ql")),M=(t("M5DT"),t("SEnB")),z=t("Z5GD"),J=t.n(z),W=t("smUt"),q=t.n(W),Z=t("rWUz"),G=t.n(Z),$=t("yKc7"),H=t.n($),Q=(t("EH+i"),t("zU1r")),X=t.n(Q),Y=(t("pko2"),t("yz32")),ee=(t("JXWm"),t("cpGE")),ae=t("CkN6"),te=t("8Ehr"),ne=t.n(te),re=D["a"].Item,le=(R["a"].Option,function(e){return Object.keys(e).map(function(a){return e[a]}).join(",")}),ie=(n=Object(N["connect"])(function(e){var a=e._auth,t=e.loading;return{_auth:a,loading:t.models._auth}}),r=D["a"].create(),n(l=r((i=function(e){function a(){var e,t;y()(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return t=b()(this,(e=S()(a)).call.apply(e,[this].concat(r))),t.state={expandForm:!1,selectedRows:[],formValues:{},columns:[{title:"${column.comment}",dataIndex:"authName"},{title:"\u6743\u9650URL(\u79fb\u52a8\u7aef\u7279\u6307\u9875\u9762)",dataIndex:"authUrl"},{title:"\u6743\u9650\u7c7b\u578b",dataIndex:"authType"},{title:"\u670d\u52a1\u7aef\u7684API\u670d\u52a1\u6743\u9650",dataIndex:"apiUrl"},{title:"\u662f\u5426\u4e3a\u53f6\u5b50\u8282\u70b9",dataIndex:"leaf"},{title:"\u662f\u5426\u53ef\u7528",dataIndex:"available"}]},t.handleStandardTableChange=function(e,a,n){var r=t.props.dispatch,l=t.state.formValues,i=Object.keys(a).reduce(function(e,t){var n=q()({},e);return n[t]=le(a[t]),n},{}),c={pager:{offset:e.current-1,limit:e.pageSize,param:q()({},l,i)}};if(n.field){var o={};o[n.field]=n.order,c.pager.sorter=[o]}r({type:"_auth/fetch",payload:c})},t.handleFormReset=function(){var e=t.props,a=e.form,n=e.dispatch;a.resetFields(),t.setState({formValues:{}}),n({type:"_auth/fetch",payload:{}})},t.toggleForm=function(){var e=t.state.expandForm;t.setState({expandForm:!e})},t.handleSelectRows=function(e){var a=t.props.handleSelectRows;t.setState({selectedRows:e}),a&&a(e)},t.handleSearch=function(e){e.preventDefault();var a=t.props,n=a.dispatch,r=a.form;r.validateFields(function(e,a){if(!e){var r=q()({},a,{updatedAt:a.updatedAt&&a.updatedAt.valueOf()});t.setState({formValues:r}),n({type:"_auth/fetch",payload:{pager:{param:r}}})}})},t}return F()(a,e),E()(a,[{key:"componentDidMount",value:function(){var e=this.props,a=e.dispatch,t=e.param,n=e.form.setFieldsValue;a({type:"_auth/fetch",payload:{pager:{param:t}}}),n(t)}},{key:"renderSimpleForm",value:function(){var e=this.props.form.getFieldDecorator;return T.a.createElement(D["a"],{onSubmit:this.handleSearch,layout:"inline"},T.a.createElement(Y["a"],{gutter:{md:8,lg:24,xl:48}},T.a.createElement(ee["a"],{md:8,sm:24},T.a.createElement(re,{label:"${column.comment}"},e("authName")(T.a.createElement(w["a"],{placeholder:"\u8bf7\u8f93\u5165"})))),T.a.createElement(ee["a"],{md:8,sm:24},T.a.createElement(re,{label:"\u6743\u9650URL(\u79fb\u52a8\u7aef\u7279\u6307\u9875\u9762)"},e("authUrl")(T.a.createElement(w["a"],{placeholder:"\u8bf7\u8f93\u5165"})))),T.a.createElement(ee["a"],{md:8,sm:24},T.a.createElement("span",{className:ne.a.submitButtons},T.a.createElement(d["a"],{type:"primary",htmlType:"submit"},"\u67e5\u8be2"),T.a.createElement(d["a"],{style:{marginLeft:8},onClick:this.handleFormReset},"\u91cd\u7f6e"),T.a.createElement("a",{style:{marginLeft:8},onClick:this.toggleForm},"\u5c55\u5f00 ",T.a.createElement(m["a"],{type:"down"}))))))}},{key:"renderAdvancedForm",value:function(){var e=this.props.form.getFieldDecorator;return T.a.createElement(D["a"],{onSubmit:this.handleSearch,layout:"inline"},T.a.createElement(Y["a"],{gutter:{md:8,lg:24,xl:48}},T.a.createElement(ee["a"],{md:8,sm:24},T.a.createElement(re,{label:"${column.comment}"},e("authName")(T.a.createElement(w["a"],{placeholder:"\u8bf7\u8f93\u5165"})))),T.a.createElement(ee["a"],{md:8,sm:24},T.a.createElement(re,{label:"\u6743\u9650URL(\u79fb\u52a8\u7aef\u7279\u6307\u9875\u9762)"},e("authUrl")(T.a.createElement(w["a"],{placeholder:"\u8bf7\u8f93\u5165"})))),T.a.createElement(ee["a"],{md:8,sm:24},T.a.createElement(re,{label:"\u7236\u7ea7\u8282\u70b9"},e("parentId")(T.a.createElement(w["a"],{placeholder:"\u8bf7\u8f93\u5165"}))))),T.a.createElement(Y["a"],{gutter:{md:8,lg:24,xl:48}},T.a.createElement(ee["a"],{md:8,sm:24},T.a.createElement(re,{label:"\u6743\u9650\u7c7b\u578b"},e("authType")(T.a.createElement(w["a"],{placeholder:"\u8bf7\u8f93\u5165"})))),T.a.createElement(ee["a"],{md:8,sm:24},T.a.createElement(re,{label:"\u670d\u52a1\u7aef\u7684API\u670d\u52a1\u6743\u9650"},e("apiUrl")(T.a.createElement(w["a"],{placeholder:"\u8bf7\u8f93\u5165"})))),T.a.createElement(ee["a"],{md:8,sm:24},T.a.createElement(re,{label:"\u662f\u5426\u4e3a\u53f6\u5b50\u8282\u70b9"},e("leaf")(T.a.createElement(w["a"],{placeholder:"\u8bf7\u8f93\u5165"}))))),T.a.createElement(Y["a"],{gutter:{md:8,lg:24,xl:48}},T.a.createElement(ee["a"],{md:8,sm:24},T.a.createElement(re,{label:"\u662f\u5426\u53ef\u7528"},e("available")(T.a.createElement(w["a"],{placeholder:"\u8bf7\u8f93\u5165"}))))),T.a.createElement("div",{style:{overflow:"hidden"}},T.a.createElement("div",{style:{marginBottom:24}},T.a.createElement(d["a"],{type:"primary",htmlType:"submit"},"\u67e5\u8be2"),T.a.createElement(d["a"],{style:{marginLeft:8},onClick:this.handleFormReset},"\u91cd\u7f6e"),T.a.createElement("a",{style:{marginLeft:8},onClick:this.toggleForm},"\u6536\u8d77 ",T.a.createElement(m["a"],{type:"up"})))))}},{key:"renderForm",value:function(){var e=this.state.expandForm;return e?this.renderAdvancedForm():this.renderSimpleForm()}},{key:"render",value:function(){var e=this.props,a=e._auth.data,t=void 0===a?{}:a,n=e.loading,r=this.state,l=r.selectedRows,i=r.columns;return T.a.createElement(u["a"],{bordered:!1},T.a.createElement("div",{className:ne.a.tableList},T.a.createElement("div",{className:ne.a.tableListForm},this.renderForm()),T.a.createElement("div",{className:ne.a.tableListOperator}),T.a.createElement(ae["a"],{selectedRows:l,loading:n,data:t,columns:i,onSelectRow:this.handleSelectRows,onChange:this.handleStandardTableChange})))}}]),a}(x["PureComponent"]),l=i))||l)||l),ce=ie,oe=(t("Kb7f"),c=Object(N["connect"])(function(e){var a=e._auth,t=e.loading;return{_auth:a,loading:t.models._auth}}),c((s=function(e){function a(e){var t;return y()(this,a),t=b()(this,S()(a).call(this,e)),t.index=0,t.cacheOriginData={},t.refreshData=!1,t.handleSubmit=function(){var e=t.state.data,a=t.props,n=a.dispatch,r=a.param,l=[],i=[],c=[];e.forEach(function(e){switch(e.beanStatus){case"insert":l.push(e);break;case"update":i.push(e);break;case"delete":c.push(e);break;default:}}),t.setState({loading:!0}),n({type:"_auth/edit",payload:{inputBean:{insert:l,delete:c,update:i}},callback:function(){n({type:"_auth/fetch",payload:{pager:{param:r}}}),t.refreshData=!0}})},t.toggleEditable=function(e,a){e.preventDefault();var n=t.state.data,r=n.map(function(e){return q()({},e)}),l=t.getRowByKey(a,r);if(l){if(l.editable){var i=q()({},l);delete i.editable,t.cacheOriginData[a]&&null!=t.cacheOriginData[a].editable&&delete t.cacheOriginData[a].editable,H()(t.cacheOriginData[a],i)||"insert"!==l.beanStatus&&(l.beanStatus="update")}else t.cacheOriginData[a]=q()({},l);l.editable=!l.editable,t.setState({data:r})}},t.newAuth=function(){var e=t.state.data,a=e.map(function(e){return q()({},e)});a.push({key:"NEW_TEMP_ID_".concat(t.index),authName:"",authUrl:"",parentId:"",authType:"",apiUrl:"",leaf:"",available:"",editable:!0,isNew:!0,beanStatus:"insert"}),t.index+=1,t.setState({data:a})},t.handleSelectAuth=function(){var e,a=t.state.data,n=t.props.param,r=a.map(function(e){return q()({},e)});t.index+=1,t.setState({data:r});var l=function(a){e.destory(),a&&a.constructor===Array&&0!==a.length&&(a.forEach(function(e){r.push(q()({key:"NEW_TEMP_ID_".concat(t.index)},e,n,{beanStatus:"insert"}))}),t.index+=1,t.setState({data:r,loading:!0}),setTimeout(function(){t.setState({loading:!1})}))};e=Object(A["a"])(T.a.createElement(K["a"],{handleOk:l},T.a.createElement(ce,null)))},t.state={data:[],loading:!1},e.triggerRef(G()(t)),t}return F()(a,e),E()(a,[{key:"componentDidMount",value:function(){var e=this.props,a=e.param,t=e.dispatch;"{}"!==JSON.stringify(a)&&(t({type:"_auth/fetch",payload:{pager:{param:a}}}),this.setState({loading:!0}),this.refreshData=!0)}},{key:"componentWillReceiveProps",value:function(e){var a=this,t=null;this.state.data;this.refreshData&&0!==e._auth.data.list.length&&(this.refreshData=!1,t=J()(e._userOrg.data.list),setTimeout(function(){a.setState({data:t,loading:!1})},500))}},{key:"getRowByKey",value:function(e,a){var t=this.state.data;return(a||t).filter(function(a){return a.key===e})[0]}},{key:"remove",value:function(e){var a=this.state.data,t=a.filter(function(a){return a.key!==e});t.push({key:e,authId:e,beanStatus:"delete"}),this.setState({data:t})}},{key:"handleKeyPress",value:function(e,a){"Enter"===e.key&&this.saveRow(e,a)}},{key:"handleFieldChange",value:function(e,a,t){var n=this.state.data,r=n.map(function(e){return q()({},e)}),l=this.getRowByKey(t,r);l&&(l[a]=e.target.value,this.setState({data:r}))}},{key:"saveRow",value:function(e,a){var t=this;e.persist(),this.setState({loading:!0}),setTimeout(function(){if(t.clickedCancel)t.clickedCancel=!1;else{var n=t.getRowByKey(a)||{};if(!n.authName||!n.authUrl||!n.parentId||!n.authType||!n.apiUrl||!n.leaf||!n.available)return M["a"].error("\u8bf7\u586b\u5199\u5b8c\u6574\u4fe1\u606f\u3002"),e.target.focus(),void t.setState({loading:!1});delete n.isNew,t.toggleEditable(e,a);t.state.data;t.setState({loading:!1})}},500)}},{key:"cancel",value:function(e,a){this.clickedCancel=!0,e.preventDefault();var t=this.state.data,n=t.map(function(e){return q()({},e)}),r=this.getRowByKey(a,n);this.cacheOriginData[a]&&(Object.assign(r,this.cacheOriginData[a]),delete this.cacheOriginData[a]),r.editable=!1,this.setState({data:n}),this.clickedCancel=!1}},{key:"render",value:function(){var e=this,a=[{title:"\u8d44\u6e90\u540d\u79f0",dataIndex:"authName",key:"authName",render:function(a,t){return t.editable?T.a.createElement(w["a"],{value:a,autoFocus:!0,onChange:function(a){return e.handleFieldChange(a,"authName",t.key)},onKeyPress:function(a){return e.handleKeyPress(a,t.key)},placeholder:"\u8d44\u6e90\u540d\u79f0"}):a}},{title:"\u6743\u9650URL(\u79fb\u52a8\u7aef\u7279\u6307\u9875\u9762)",dataIndex:"authUrl",key:"authUrl",render:function(a,t){return t.editable?T.a.createElement(w["a"],{value:a,autoFocus:!0,onChange:function(a){return e.handleFieldChange(a,"authUrl",t.key)},onKeyPress:function(a){return e.handleKeyPress(a,t.key)},placeholder:"\u6743\u9650URL(\u79fb\u52a8\u7aef\u7279\u6307\u9875\u9762)"}):a}},{title:"\u6743\u9650\u7c7b\u578b",dataIndex:"authType",key:"authType",render:function(a,t){return t.editable?T.a.createElement(w["a"],{value:a,autoFocus:!0,onChange:function(a){return e.handleFieldChange(a,"authType",t.key)},onKeyPress:function(a){return e.handleKeyPress(a,t.key)},placeholder:"\u6743\u9650\u7c7b\u578b"}):a}},{title:"\u670d\u52a1\u7aef\u7684API\u670d\u52a1\u6743\u9650",dataIndex:"apiUrl",key:"apiUrl",render:function(a,t){return t.editable?T.a.createElement(w["a"],{value:a,autoFocus:!0,onChange:function(a){return e.handleFieldChange(a,"apiUrl",t.key)},onKeyPress:function(a){return e.handleKeyPress(a,t.key)},placeholder:"\u670d\u52a1\u7aef\u7684API\u670d\u52a1\u6743\u9650"}):a}},{title:"\u662f\u5426\u4e3a\u53f6\u5b50\u8282\u70b9",dataIndex:"leaf",key:"leaf",render:function(a,t){return t.editable?T.a.createElement(w["a"],{value:a,autoFocus:!0,onChange:function(a){return e.handleFieldChange(a,"leaf",t.key)},onKeyPress:function(a){return e.handleKeyPress(a,t.key)},placeholder:"\u662f\u5426\u4e3a\u53f6\u5b50\u8282\u70b9"}):a}},{title:"\u662f\u5426\u53ef\u7528",dataIndex:"available",key:"available",render:function(a,t){return t.editable?T.a.createElement(w["a"],{value:a,autoFocus:!0,onChange:function(a){return e.handleFieldChange(a,"available",t.key)},onKeyPress:function(a){return e.handleKeyPress(a,t.key)},placeholder:"\u662f\u5426\u53ef\u7528"}):a}},{title:"\u64cd\u4f5c",key:"action",render:function(a,t){var n=e.state.loading;return t.editable&&n?null:t.editable?t.isNew?T.a.createElement("span",null,T.a.createElement("a",{onClick:function(a){return e.saveRow(a,t.key)}},"\u6dfb\u52a0"),T.a.createElement(B["a"],{type:"vertical"}),T.a.createElement(j["a"],{title:"\u662f\u5426\u8981\u5220\u9664\u6b64\u884c\uff1f",onConfirm:function(){return e.remove(t.key)}},T.a.createElement("a",null,"\u5220\u9664"))):T.a.createElement("span",null,T.a.createElement("a",{onClick:function(a){return e.saveRow(a,t.key)}},"\u4fdd\u5b58"),T.a.createElement(B["a"],{type:"vertical"}),T.a.createElement("a",{onClick:function(a){return e.cancel(a,t.key)}},"\u53d6\u6d88")):T.a.createElement("span",null,T.a.createElement("a",{onClick:function(a){return e.toggleEditable(a,t.key)}},"\u7f16\u8f91"),T.a.createElement(B["a"],{type:"vertical"}),T.a.createElement(j["a"],{title:"\u662f\u5426\u8981\u5220\u9664\u6b64\u884c\uff1f",onConfirm:function(){return e.remove(t.key)}},T.a.createElement("a",null,"\u5220\u9664")))}}],t=this.state,n=t.loading,r=t.data;return T.a.createElement(x["Fragment"],null,T.a.createElement("div",{className:X.a.tableListOperator},T.a.createElement(d["a"],{icon:"plus",type:"primary",onClick:this.handleSelectAuth},"\u9009\u62e9\u7cfb\u7edf\u8d44\u6e90")),T.a.createElement(V["a"],{loading:n,columns:a,dataSource:r.filter(function(e){return"delete"!==e.beanStatus}),pagination:!1,rowClassName:function(e){return e.editable?X.a.editable:""}}),T.a.createElement(d["a"],{style:{width:"100%",marginTop:16,marginBottom:8},type:"dashed",onClick:this.newAuth,icon:"plus"},"\u65b0\u589e"))}}]),a}(x["PureComponent"]),o=s))||o);oe.defaultProps={param:{},triggerRef:function(){}};var se,de,ue,me,he=oe,pe=D["a"].Item,fe=R["a"].Option,ye=(I["a"].RangePicker,w["a"].TextArea,se=Object(N["connect"])(function(e){var a=e._role,t=e.loading;return{_role:a,submitting:t.effects["_role/add"]}}),de=D["a"].create(),se(ue=de((me=function(e){function a(){var e,t;y()(this,a);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return t=b()(this,(e=S()(a)).call.apply(e,[this].concat(r))),t.state={beanStatus:"add"},t.handleSubmit=function(e){var a,n=t.props,r=n.dispatch,l=n.form,i=t.state.beanStatus;switch(e.preventDefault(),i){case"add":a="_role/add";break;case"update":a="_role/update";break;default:}l.validateFieldsAndScroll(function(e,n){if(!e){for(var l in n)n[l]&&n[l].format&&(n[l]=n[l]-0);r({type:a,payload:n,callback:function(){t.setState({beanStatus:"update"})}})}})},t.handleNavigateBack=function(){O["a"].goBack()},t.handleRoleTypeClick=function(){var e,a=t.props.form,n=a.setFieldsValue,r=a.getFieldValue,l=function(a){e.destory(),a&&a.constructor===Array&&0!==a.length&&n({roleType:a[0].codeId})},i=r("roleType");e=Object(A["a"])(T.a.createElement(K["a"],{handleOk:l,param:{codeItemId:"ROLE",codeId:i}},T.a.createElement(L["a"],null)))},t}return F()(a,e),E()(a,[{key:"componentDidMount",value:function(){var e=this.props.match.params;if("{}"!==JSON.stringify(e)){this.setState({beanStatus:"update"});var a=this.props.dispatch;a({type:"_role/fetchOne",payload:e})}}},{key:"render",value:function(){var e=this.state.beanStatus,a=this.props.match.params,t=this.props._role.object,n=void 0===t?{}:t,r=this.props,l=r.submitting,i=r.form,c=i.getFieldDecorator,o=(i.getFieldValue,{labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:12},md:{span:10}}});return"add"===e&&(n={}),T.a.createElement(_["a"],{title:T.a.createElement(P["FormattedMessage"],{id:"app.forms.basic.title"}),content:T.a.createElement(P["FormattedMessage"],{id:"app.forms.basic.description"})},T.a.createElement(u["a"],{bordered:!1},T.a.createElement(D["a"],{onSubmit:this.handleSubmit,hideRequiredMark:!0,style:{marginTop:8}},c("roleId",{initialValue:n.roleId})(T.a.createElement(w["a"],{type:"hidden",placeholder:""})),T.a.createElement(pe,p()({},o,{label:"\u89d2\u8272\u540d\u79f0"}),c("roleName",{initialValue:n.roleName,rules:[{required:!0,message:"\u5fc5\u586b\u9879"}]})(T.a.createElement(w["a"],{placeholder:""}))),T.a.createElement(pe,p()({},o,{label:"\u89d2\u8272\u63cf\u8ff0"}),c("roleDescription",{initialValue:n.roleDescription,rules:[{required:!0,message:"\u5fc5\u586b\u9879"}]})(T.a.createElement(w["a"],{placeholder:""}))),T.a.createElement(pe,p()({},o,{label:"\u89d2\u8272\u7c7b\u578b"}),c("roleType",{initialValue:n.roleType,rules:[{required:!0,message:"\u5fc5\u9009\u9879"}]})(T.a.createElement(w["a"],{placeholder:"",disabled:!0,addonAfter:T.a.createElement(m["a"],{type:"search",onClick:this.handleRoleTypeClick})}))),T.a.createElement(pe,p()({},o,{label:"\u89d2\u8272\u6570\u91cf"}),c("roleNumber",{initialValue:n.roleNumber})(T.a.createElement(w["a"],{placeholder:""}))),c("userId",{initialValue:n.userId})(T.a.createElement(w["a"],{type:"hidden",placeholder:""})),c("orgId",{initialValue:n.orgId})(T.a.createElement(w["a"],{type:"hidden",placeholder:""})),T.a.createElement(pe,p()({},o,{label:"\u89d2\u8272\u6240\u5c5e\u5e73\u53f0"}),c("platform",{initialValue:n.platform,rules:[{required:!0,message:"\u5fc5\u586b\u9879"}]})(T.a.createElement(R["a"],{value:"app"},T.a.createElement(fe,{value:"app"},"\u79fb\u52a8\u7aef"),T.a.createElement(fe,{value:"admin"},"\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf")))))),"update"===e&&T.a.createElement(u["a"],{title:"\u89d2\u8272\u8d44\u6e90\u7ba1\u7406",style:{marginTop:"20px"}},T.a.createElement(he,{param:{authId:n.authId||a.authId}})),T.a.createElement(U["a"],{style:{width:"100%"}},T.a.createElement(d["a"],{type:"primary",htmlType:"submit",onClick:this.handleSubmit,loading:l},T.a.createElement(P["FormattedMessage"],{id:"form.submit"})),T.a.createElement(d["a"],{htmlType:"button",style:{marginLeft:8},onClick:this.handleNavigateBack},"\u8fd4\u56de")))}}]),a}(x["PureComponent"]),ue=me))||ue)||ue);a["default"]=ye}}]);